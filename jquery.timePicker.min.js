(function(E){E.fn.timePicker=function(I){var J=E.extend({},E.fn.timePicker.defaults,I);
return this.each(function(){E.timePicker(this,J)
})
};
E.timePicker=function(K,I){var J=E(K)[0];
return J.timePicker||(J.timePicker=new jQuery._timePicker(J,I))
};
E.timePicker.version="0.3";
E._timePicker=function(S,N){var W=false;
var U=false;
var L=D(N.startTime,N);
var Q=D(N.endTime,N);
var I="selected";
var T="li."+I;
E(S).attr("autocomplete","OFF");
var K=[];
var M=new Date(L);
while(M<=Q){K[K.length]=G(M,N);
M=new Date(M.setMinutes(M.getMinutes()+N.step))
}var V=E('<div class="time-picker'+(N.show24Hours?"":" time-picker-12hours")+'"></div>');
var O=E("<ul></ul>");
for(var P=0;
P<K.length;
P++){O.append("<li>"+K[P]+"</li>")
}V.append(O);
V.appendTo("body").hide();
V.mouseover(function(){W=true
}).mouseout(function(){W=false
});
E("li",O).mouseover(function(){if(!U){E(T,V).removeClass(I);
E(this).addClass(I)
}}).mousedown(function(){W=true
}).click(function(){F(S,this,V,N);
W=false
});
var R=function(){if(V.is(":visible")){return false
}var b=function(g){var f=false;
E(g.target).parents().each(function(){f|=(this===V.first().get());
return f
});
f|=(this===S);
if(!f){H(V)
}};
V.data("clickOutListener",b);
E(document).delegate("*","click",b);
E("li",V).removeClass(I);
var a=E(S).offset();
V.css({top:a.top+S.offsetHeight,left:a.left});
V.show();
var d=S.value?B(S.value,N):L;
var c=L.getHours()*60+L.getMinutes();
var Z=(d.getHours()*60+d.getMinutes())-c;
var X=Math.round(Z/N.step);
var Y=A(new Date(0,0,0,0,(X*N.step+c),0));
Y=(L<Y&&Y<=Q)?Y:L;
var e=E("li:contains("+G(Y,N)+")",V);
if(e.length){e.addClass(I);
V[0].scrollTop=e[0].offsetTop
}return true
};
E(S).focus(R).click(R);
E(S).blur(function(){if(!W){H(V)
}});
var J=(E.browser.opera||E.browser.mozilla)?"keypress":"keydown";
E(S)[J](function(c){var X;
U=true;
var b=V[0].scrollTop;
switch(c.keyCode){case 38:if(R()){return false
}X=E(T,O);
var Z=X.prev().addClass(I)[0];
if(Z){X.removeClass(I);
if(Z.offsetTop<b){V[0].scrollTop=b-Z.offsetHeight
}}else{X.removeClass(I);
Z=E("li:last",O).addClass(I)[0];
V[0].scrollTop=Z.offsetTop-Z.offsetHeight
}return false;
break;
case 40:if(R()){return false
}X=E(T,O);
var Y=X.next().addClass(I)[0];
if(Y){X.removeClass(I);
if(Y.offsetTop+Y.offsetHeight>b+V[0].offsetHeight){V[0].scrollTop=b+Y.offsetHeight
}}else{X.removeClass(I);
Y=E("li:first",O).addClass(I)[0];
V[0].scrollTop=0
}return false;
break;
case 13:if(V.is(":visible")){var a=E(T,O)[0];
F(S,a,V,N)
}return false;
break;
case 27:H(V);
return false;
break
}return true
});
E(S).keyup(function(X){U=false
});
this.getTime=function(){return B(S.value,N)
};
this.setTime=function(X){S.value=G(D(X,N),N);
E(S).change()
}
};
E.fn.timePicker.defaults={step:30,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),separator:":",show24Hours:true};
function H(I){var J=I.data("clickOutListener");
E(document).undelegate("*","click",J);
I.removeData("clickOutListener");
I.hide()
}function F(L,K,I,J){L.value=E(K).text();
E(L).change();
if(!E.browser.msie){L.focus()
}H(I)
}function G(M,L){var K=M.getHours();
var I=L.show24Hours?K:(((K+11)%12)+1);
var J=M.getMinutes();
return C(I)+L.separator+C(J)+(L.show24Hours?"":((K<12)?" AM":" PM"))
}function C(I){return(I<10?"0":"")+I
}function D(I,J){return(typeof I=="object")?A(I):B(I,J)
}function B(J,L){if(J){var N=J.split(L.separator);
var I=parseFloat(N[0]);
var K=parseFloat(N[1]);
if(!L.show24Hours){if(I===12&&J.indexOf("AM")!==-1){I=0
}else{if(I!==12&&J.indexOf("PM")!==-1){I+=12
}}}var M=new Date(0,0,0,I,K,0);
return A(M)
}return null
}function A(I){I.setFullYear(2001);
I.setMonth(0);
I.setDate(0);
return I
}})(jQuery);